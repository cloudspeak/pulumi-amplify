# Pulumi Amplify example

This folder contains an example Pulumi program and client application which demonstrates
use of the `pulumi_amplify` package.  It implements a React app which allows users to
create simple notes which are stored in a database.  The notes can only be updated and
deleted by their original creator.

In this example, the Amplify API has already been created using the Amplify CLI, as per
the instructions in `pulumi-amplify`'s README.  The Pulumi program creates the Cognito
User Pool, and deploys the Amplify-generated API.

The project works like this:

* The `src` directory contains the React app
* The `amplify` directory contains a GraphQL schema and AppSync resolvers which were generated by Amplify
* The `__main__.py` file contains a Pulumi program which deploys an `AmplifyGraphQLAPI` resorce using the files in the Amplify directory
  * Every time the Pulumi program deploys, it creates an `aws-exports.js` file in `src` with the relevant parameters for the frontend


## Getting started

**To run this example:**

* Install and enter a VirtualEnv in this folder
* Install the Pulumi requirements:

```
pip install -r requirements.txt
```

* Locally install (or reinstall) the `pulumi_amplify` package from the root directory:

```
pip install -e ..
```

* Initialize your Amplify environment (you may be promted to set up an AWS profile):

```
amplify init
```

* Deploy the stack:

```
pulumi up
```

* Install up the frontend client dependencies and run the client:

```
npm install
npm start
```

You can now visit [`http://localhost:3000`](http://localhost:3000) in your browser to use the application.

## Updating the schema

The GraphQL schema is located in `amplify/backend/api/notespulumi/schema.graphql`.  If
you change the schema, you will need to use Amplify to regenerate the backend resolvers
and (optionally) the frontend request models:

* Rebuild the backend schema and resolvers:

```
amplify api gql-compile
```

* Push the new backend configuration to AppSync:

```
pulumi up
```

* Rebuild the frontend request models into `src/graphql` (if you are using them):

```
amplify codegen
```
